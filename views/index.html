<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <title>Raspberry Pi Dashboard</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
	
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/css/font-awesome.min.css">
	
	<!-- Custom styles for this template -->
    <link href="/css/dashboard.css" rel="stylesheet">
  </head>

  <body>
    <nav class="navbar navbar-toggleable-md navbar-inverse fixed-top bg-inverse">
      <img src="/img/Raspberry_Pi_Logo.svg" alt="Currant Pi Logo" class="title_logo"> <a class="navbar-brand" href="#">Pi Dashboard</a>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <nav class="col-sm-3 col-md-2 hidden-xs-down bg-faded sidebar">
          <ul class="nav nav-pills flex-column">
            <li class="nav-item">
              <a class="nav-link" href="#card-hardware">Hardware</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#card-network">Network</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#card-cpu">CPU Load</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#card-memory">Memory</a>
            </li>
          </ul>
        </nav>

        <main class="col-sm-9 offset-sm-3 col-md-10 offset-md-2 pt-3">
          <h1>Dashboard</h1>

          <section class="row mb-3">
			<div class="col-lg-6 col-md-6">
				<div id="card-hardware" class="card">
					<div class="card-block">
						<h4 class="card-title"><i class="fa fa-server"></i> Hardware</h4>
						<table class="table table-striped table-hover">
							<tbody>
								<tr>
									<td><p>Hostname: </p></td>
									<td><p id="hostname" class="text-right"></p></td>
								</tr>
								<tr>
									<td><p>Kernel: </p></td>
									<td><p id="kernel" class="text-right"></p></td>
								</tr>
								<tr>
									<td><p>Uptime: </p></td>
									<td><p id="uptime" class="text-right"></p></td>
								</tr>
								<tr>
									<td><p>Board Temperature: </p></td>
									<td><p id="temperature" class="text-right"></p></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="col-lg-6 col-md-6">
				<div id="card-network" class="card">
					<div class="card-block">
						<h4 class="card-title"><i class="fa fa-exchange"></i> Network</h4>
						<table class="table table-striped table-hover">
							<tbody>
								<tr>
									<td><p>Down:</p></td>
									<td><p id="network_data_down" class="text-right"></p></td>
								</tr>
								<tr>
									<td><p>Up:</p></td>
									<td><p id="network_data_up" class="text-right"></p></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
          </section>

          <section class="row mb-3">
			<div class="col-lg-12 col-md-12">
				<div id="card-cpu" class="card">
					<div class="card-block">
						<h4 class="card-title"><i class="fa fa-microchip"></i> CPU Load</h4>
						<div class="container" id="cpu_usage" style="width:100%; height:300px;"></div>
					</div>
				</div>
			</div>
          </section>
			
          <section class="row mb-3">
			<div class="col-lg-12 col-md-12">
				<div id="card-memory" class="card">
					<div class="card-block">
						<h4 class="card-title"><i class="fa fa-tachometer"></i> Memory</h4>
						<table class="table table-striped table-hover">
							<tbody>
								<tr>
									<td colspan="4">
										<div class="row row-memory">
											<div class="col-lg-9 col-md-9">
												<div class="progress">
													<div id="progress-bar-used" class="progress-bar bg-danger" 
														role="progressbar" 
														style="width: 0%" 
														aria-valuenow="0" 
														aria-valuemin="0" 
														aria-valuemax="100">
													</div>
													<div id="progress-bar-buffers" class="progress-bar bg-warning" 
														role="progressbar" 
														style="width: 0%" 
														aria-valuenow="0" 
														aria-valuemin="0" 
														aria-valuemax="100">
													</div>
													<div id="progress-bar-cache" class="progress-bar bg-info" 
														role="progressbar" 
														style="width: 0%" 
														aria-valuenow="0" 
														aria-valuemin="0" 
														aria-valuemax="100">
													</div>
													<div id="progress-bar-free" class="progress-bar bg-success" 
														role="progressbar" 
														style="width: 0%" 
														aria-valuenow="0" 
														aria-valuemin="0" 
														aria-valuemax="100">
													</div>
												</div>
											</div>
											<div class="col-lg-3 col-md-3">
												<p id="memory-total" class="text-right"></p>
											</div>
										</div>
									</td>
								</tr>
								<tr>
									<td class="membar-key">
										<div class="progress">
											<div id="membar-key-used" class="progress-bar bg-danger" role="progressbar" style="width: 100%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">25%</div>
										</div>
									</td>
									<td>
										<p>Used</p>
									</td>
									<td class="membar-key">
										<div class="progress">
											<div id="membar-key-buffers" class="progress-bar bg-warning" role="progressbar" style="width: 100%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
										</div>
									</td>
									<td>
										<p>Buffers</p>
									</td>
								</tr>

								<tr>
									<td class="membar-key">
										<div class="progress">
											<div id="membar-key-cache" class="progress-bar bg-info" role="progressbar" style="width: 100%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
										</div>
									</td>
									<td>
										<p>Cache</p>
									</td>
									<td class="membar-key">
										<div class="progress">
											<div id="membar-key-free" class="progress-bar bg-success" role="progressbar" style="width: 100%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
										</div>
									</td>
									<td>
										<p>Free</p>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
          </section>
        </main>
      </div>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/js/jquery.min.js"></script>
	<script src="/js/tether.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
	<script src="/js/highstock.js"></script>
	<script src="/js/exporting.js"></script>
	<script src="/js/socket.io.min.js"></script>
	<script>
		var socket = io.connect('http://'+ location.host);
		
		socket.on('hostname', function (hname) {
			document.getElementById("hostname").innerHTML = hname;
		});

		socket.on('kernel', function (ker) {
			document.getElementById("kernel").innerHTML = ker;
		}); 
		
		socket.on('uptime', function (uptime) {
		  document.getElementById("uptime").innerHTML = uptime;
		});
		
		socket.on('temperature', function (temperature) {
		  document.getElementById("temperature").innerHTML = temperature;
		});
		
		socket.on('network_data_down', function (network_data_down) {
		  document.getElementById("network_data_down").innerHTML = network_data_down;
		});
			
		socket.on('network_data_up', function (network_data_up) {
		  document.getElementById("network_data_up").innerHTML = network_data_up;
		});
		
		socket.on('memoryTotal', function (mem) {
			document.getElementById("memory-total").innerHTML = mem + ' KB';
		});
		
		socket.on('memoryUpdate', function (free, used, buffered, cached) {
			$('#progress-bar-used').attr('aria-valuenow', used).css('width',used+'%');
			$('#progress-bar-buffers').attr('aria-valuenow', buffered).css('width',buffered+'%');
			$('#progress-bar-cache').attr('aria-valuenow', cached).css('width',cached+'%');
			$('#progress-bar-free').attr('aria-valuenow', free).css('width',free+'%');
			
			document.getElementById("membar-key-used").innerHTML = used+'%';
			document.getElementById("membar-key-buffers").innerHTML = used+'%';
			document.getElementById("membar-key-cache").innerHTML = used+'%';
			document.getElementById("membar-key-free").innerHTML = used+'%';
		});
			
		// Charts
		var chartCPU;

		chartCPU = new Highcharts.StockChart({
			chart: {
				renderTo: 'cpu_usage', 
				defaultSeriesType: 'spline',
				events: {
					load: function() {
						// Cada vez que reciba un valor desde el socket, lo meto en la gráfica
						socket.on('cpuUsageUpdate', function (time, data) {
							var series = chartCPU.series[0];
							series.addPoint([time, data]);
						});
					}
				}
			},
			rangeSelector : {
				selected : 100
			},
			xAxis: {
				type: 'datetime',
				tickPixelInterval: 150,
				maxZoom: 20 * 1000
			},
			yAxis: {
				minPadding: 0.2,
				maxPadding: 0.2,
				title: {
					text: 'CPU Load (%)',
					margin: 10
				}
			},
			series: [{
				name: 'CPU Load',
				data: []
			}],
			credits: {
					enabled: false
			}
		});
	</script>
  </body>
</html>
